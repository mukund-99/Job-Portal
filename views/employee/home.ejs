<%- include('navbar.ejs') %>
<!-- <!DOCTYPE html> -->
<html lang="en">
<head>
    <!-- <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Dashboard - CareerConnect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet"> -->
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --success: #10b981;
        }
        
        body {
            background-color: #f5f7fb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark);
        }
        
        .sidebar {
            background: white;
            height: 100vh;
            position: fixed;
            width: 280px;
            border-right: 1px solid #e2e8f0;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        
        .content {
            margin-left: 300px;
            padding: 30px;
        }
        
        .profile-box {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        
        .job-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
            margin-bottom: 20px;
        }
        
        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .job-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .company-name {
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .job-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .salary {
            font-weight: 600;
            color: var(--success);
        }
        
        .location {
            color: var(--gray);
        }
        
        .apply-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
        }
        
        .apply-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-save {
            background-color: transparent;
            border: 2px solid var(--gray);
            color: var(--gray);
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn-save:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .profile-pic {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--primary);
        }
        
        .nav-link {
            color: var(--dark);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: #e0f2fe;
            color: var(--primary);
        }
        
        .nav-link i {
            width: 20px;
            margin-right: 10px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--dark);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }
        
        .profile-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .progress {
            height: 8px;
            margin: 15px 0;
        }
        
        .progress-bar {
            background-color: var(--primary);
        }
        
        .company-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .company-card:hover {
            transform: translateY(-5px);
        }
        
        .company-logo {
            width: 60px;
            height: 60px;
            background: #e0f2fe;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .company-rating {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        
        .rating-value {
            font-weight: 600;
            margin-right: 5px;
        }
        
        .reviews {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .btn-view-jobs {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-view-jobs:hover {
            background-color: var(--primary);
            color: white;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .content {
                margin-left: 0;
            }
            
            .job-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .profile-stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <!-- <div class="sidebar">
        <div class="text-center mb-4">
            <img src="<%= (employee[0].profile_photo) ? employee[0].profile_photo : 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNzXYh-X4wxX1jfbPywa8HWoNGDnx1Tlo0-g&s' %>" class="profile-pic">
            <h5 class="mt-3"> <%= employee[0].employee_name %></h5>
            <p class="text-muted small"> <%= employee[0].current_designation || 'No Designation' %></p>
            <a href="/logout" class="btn btn-sm btn-outline-danger mt-2">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </a>
        </div>
        
        <div class="profile-completion mb-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small text-muted">Profile Strength</span>
                <span class="small fw-bold text-primary"><%= typeof profileCompletePercent !== 'undefined' ? profileCompletePercent : '0' %></span>
            </div>
            <div class="progress">
                <div class="progress-bar" style="width: <%= typeof profileCompletePercent !== 'undefined' ? profileCompletePercent + '%' : '0%' %>"></div>
            </div>
            <a href="#" class="btn btn-primary btn-sm w-100 mt-2">
                Complete Profile
            </a> 
        </div>
        
        <hr>
        
        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="./home.ejs" class="nav-link active">
                    <i class="fa-solid fa-house"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="/employee/complete_profile" class="nav-link">
                    <i class="fa-solid fa-user"></i> Profile
                </a>
            </li>
            <li class="nav-item">
                <a href="/employee/applied_jobs" class="nav-link">
                    <i class="fa-solid fa-briefcase"></i> Applied Jobs
                </a>
            </li>
            <li class="nav-item">
                <a href="/employee/saved_jobs" class="nav-link">
                    <i class="fa-solid fa-bookmark"></i> Saved Jobs
                </a>
            </li>
            <li class="nav-item">
                <a href="/employee/job_alerts" class="nav-link">
                    <i class="fa-solid fa-bell"></i> Job Alerts
                </a>
            </li>
        </ul>
    </div> -->

    <!-- Main Content -->
    <div class="content">
        <!-- Welcome Section -->
        <div class="profile-box">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h3>Welcome back,  <%= employee[0].employee_name %></h3>
                    <p class="text-muted mb-0">Here are your personalized job recommendations based on your profile.</p>
                </div>
                <div class="col-md-4">
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value"><%= jobs[0].total_applied_jobs || 0 %></div>
                            <div class="stat-label">Applied</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value"><%= total_saved  || 0 %></div>
                            <div class="stat-label">Saved</div>
                        </div>
                        <!-- <div class="stat-item">
                            <div class="stat-value"> profileViews || 0 </div>
                            <div class="stat-label">Profile Views</div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommended Jobs -->
        <h3 class="section-title">Recommended Jobs for You</h3>
        
        <div class="row">
            <% if (employee && jobs.length > 0) { %>
                <% jobs.forEach(job => { %>
                    <div class="col-md-6 col-lg-4">
                        <div class="job-card">
                            <h5 class="job-title"> <%= job.job_title %></h5>
                            <p class="company-name">
                                <i class="fa-solid fa-building"></i>  <%= job.company_name %> 
                            </p>
                            <div class="job-meta">
                                <span class="salary">
                                    <i class="fa-solid fa-briefcase"></i>  <%=job.job_type%>
                                </span>
                                <span class="location">
                                    <i class="fa-solid fa-location-dot"></i> <%= job.company_location %>
                                </span>
                            </div>
                                <p> <i class="fa-solid fa-circle-info text-info"></i> <%=job.job_description%></p>
                            <div>
                            </div >
                            <span>
                                
                                <p> <i class="fa-solid fa-laptop-code text-primary"></i> <%=job.skills_required%></p>
                            </span>    
                            <div>
                                 
                            </div>
                            <p class="text-muted small mb-3">
                                <i class="fa-solid fa-clock"></i> Posted on (<%=job.created_at.toLocaleDateString('en-in')%>) 
                            </p>
                            
                            <!-- <form action="/employee/apply_job/<%= job.job_id %>" method="POST"> -->
                                <!-- <input type="hidden" name="job_id" value=" <%= job.job_id %>"> -->
                                        <% if (job.has_applied == 0) { %>
                                            <button type="submit" class="apply-btn" onclick="apply_job('<%= job.job_id %>')">
                                            <i class="fa-solid fa-paper-plane"></i> Apply Now
                                            </button>
                                            
                                        <% } else { %>
                                            <button class="btn btn-success w-100" disabled>
                                                <i class="fa-solid fa-check"></i> Applied
                                            </button>
                                        <% } %>
                                       
                            <!-- </form> -->
                           <% if(job.has_saved == 0) { %>
                            <button class="btn-save" onclick="saveJob( job.job_id )">
                               <a href="/employee/save_job/<%= job.job_id %>" class="text-decoration-none"> <i class="fa-regular fa-bookmark"></i> Save Job </a>
                            </button>
                            <% } else { %>
                                

                                <button class="btn-save" style="border-color: #10b981; color: #10b981;" onclick="unsaveJob( job.job_id )">
                               <a href="/employee/unsave_job/<%= job.job_id %>" class="text-decoration-none">
                                <i class="fa-solid fa-bookmark"></i> Unsave Job </a>
                            </button>
                            <% } %>



                        </div>
                    </div>
                <% }) %>
              <% } else { %> 
                <div class="col-12">
                    <div class="job-card text-center py-5">
                        <i class="fa-solid fa-briefcase fa-3x text-muted mb-3"></i>
                        <h4>No jobs available right now</h4>
                        <p class="text-muted">Check back later for new job opportunities.</p>
                        <a href="/jobs" class="btn btn-primary">Browse All Jobs</a>
                    </div>
                </div>
            <% } %>
        </div>

        <!-- Top Companies -->
        <h3 class="section-title mt-5">Explore Top Companies</h3>
        
        <div class="row">
            <div class="col-md-4">
                <div class="company-card">
                    <div class="company-logo">ICICI</div>
                    <h5 class="company-name">ICICI Prudential</h5>
                    <div class="company-rating">
                        <span class="rating-value">4.0</span>
                        <span class="reviews">7.2K+ reviews</span>
                    </div>
                    <button class="btn-view-jobs">View Jobs</button>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="company-card">
                    <div class="company-logo">WF</div>
                    <h5 class="company-name">Wells Fargo</h5>
                    <div class="company-rating">
                        <span class="rating-value">3.7</span>
                        <span class="reviews">7.7K+ reviews</span>
                    </div>
                    <button class="btn-view-jobs">View Jobs</button>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="company-card">
                    <div class="company-logo">TE</div>
                    <h5 class="company-name">TEUS</h5>
                    <div class="company-rating">
                        <span class="rating-value">3.8</span>
                        <span class="reviews">1.4K+ reviews</span>
                    </div>
                    <button class="btn-view-jobs">View Jobs</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Launch demo modal
</button> -->

<!-- Modal -->
 <form action="/employee/apply_job" method="post" enctype="multipart/form-data">
<div class="modal fade" id="apply_job_modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Apply For Job</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
    <input type="hidden" name="job_id" id="job_id_input">
<!--  -->
        Upload Resume/Cv
        <input type="file" id="resume_file" name="resume_file" class="form-control">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Submit Application</button>
      </div>
    </div>
  </div>
</div>
</form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>



        function apply_job(job_id){
            // alert(job_id)
            $('#job_id_input').val(job_id)
            $('#apply_job_modal').modal('show');
        }



        // Job application functionality
        // function applyForJob(jobId) {
        //     if (confirm('Are you sure you want to apply for this job?')) {
        //         // In a real application, this would make an AJAX call
        //         fetch('/employee/apply_job', {
        //             method: 'POST',
        //             headers: {
        //                 'Content-Type': 'application/json',
        //             },
        //             body: JSON.stringify({ job_id: jobId })
        //         })
        //         .then(response => response.json())
        //         .then(data => {
        //             if (data.success) {
        //                 alert('Application submitted successfully!');
        //                 // Update UI
        //                 const applyBtn = document.querySelector(`[onclick="applyForJob(${jobId})"]`);
        //                 applyBtn.innerHTML = '<i class="fa-solid fa-check"></i> Applied';
        //                 applyBtn.disabled = true;
        //                 applyBtn.classList.remove('apply-btn');
        //                 applyBtn.classList.add('btn-success');
        //             } else {
        //                 alert('Error applying for job: ' + data.message);
        //             }
        //         })
        //         .catch(error => {
        //             console.error('Error:', error);
        //             alert('Error applying for job');
        //         });
        //     }
        // }
        
        // Save job functionality
        function saveJob(jobId) {
            fetch('/employee/save_job', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ job_id: jobId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Job saved successfully!');
                    // Update UI
                    const saveBtn = document.querySelector(`[onclick="saveJob(${jobId})"]`);
                    saveBtn.innerHTML = '<i class="fa-solid fa-bookmark"></i> Saved';
                    saveBtn.style.borderColor = '#10b981';
                    saveBtn.style.color = '#10b981';
                } else {
                    alert('Error saving job: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving job');
            });
        }
        
        // Format time ago (you would need to implement this function)
        function formatTimeAgo(dateString) {
            // Implementation for showing "2 days ago", "1 week ago", etc.
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return '1 day ago';
            if (diffDays < 7) return diffDays + ' days ago';
            if (diffDays < 30) return Math.ceil(diffDays / 7) + ' weeks ago';
            return Math.ceil(diffDays / 30) + ' months ago';
        }
        
        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', function() {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>